{"ast":null,"code":"import _objectSpread from \"C:\\\\Users\\\\Elton\\\\OneDrive\\\\Desktop\\\\baseapp-2024\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport { orderBookSideLimit } from '../../../api';\nimport { handleIncrementalUpdate, handleIncrementalUpdateArray, sliceArray } from '../../../helpers';\nimport { DEPTH_DATA, DEPTH_DATA_INCREMENT, DEPTH_DATA_SNAPSHOT, DEPTH_ERROR, DEPTH_FETCH, DEPTH_INCREMENT_SUBSCRIBE, ORDER_BOOK_DATA, ORDER_BOOK_ERROR, ORDER_BOOK_FETCH } from './constants';\n// TODO: Move market depth to his own module\n\nexport var initialOrderBook = {\n  asks: [],\n  bids: [],\n  loading: false\n};\nexport var initialDepth = {\n  asks: [],\n  bids: [],\n  loading: false\n};\nexport var initialIncrementDepth = {\n  marketId: undefined,\n  asks: [],\n  bids: [],\n  sequence: null,\n  loading: false\n};\nexport var orderBookReducer = function orderBookReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialOrderBook;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  switch (action.type) {\n    case ORDER_BOOK_FETCH:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        loading: true,\n        error: undefined\n      });\n    case ORDER_BOOK_DATA:\n      var _action$payload = action.payload,\n        asks = _action$payload.asks,\n        bids = _action$payload.bids;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        asks: sliceArray(asks, orderBookSideLimit()),\n        bids: sliceArray(bids, orderBookSideLimit()),\n        loading: false,\n        error: undefined\n      });\n    case ORDER_BOOK_ERROR:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        loading: false,\n        error: action.error\n      });\n    default:\n      return state;\n  }\n};\nexport var depthReducer = function depthReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialDepth;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  switch (action.type) {\n    case DEPTH_FETCH:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        loading: true,\n        error: undefined,\n        timestamp: Math.floor(Date.now() / 1000)\n      });\n    case DEPTH_DATA:\n      var _action$payload2 = action.payload,\n        asks = _action$payload2.asks,\n        bids = _action$payload2.bids;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        asks: sliceArray(asks, orderBookSideLimit()),\n        bids: sliceArray(bids, orderBookSideLimit()),\n        loading: false,\n        error: undefined\n      });\n    case DEPTH_ERROR:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        loading: false,\n        error: action.error\n      });\n    default:\n      return state;\n  }\n};\nexport var incrementDepthReducer = function incrementDepthReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialIncrementDepth;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n  switch (action.type) {\n    case DEPTH_INCREMENT_SUBSCRIBE:\n      return _objectSpread(_objectSpread({}, state), {}, {\n        marketId: action.payload,\n        loading: state.marketId === undefined || state.marketId !== action.payload,\n        timestamp: Math.floor(Date.now() / 1000)\n      });\n    case DEPTH_DATA_INCREMENT:\n      var payload = _objectSpread(_objectSpread({}, state), {}, {\n        sequence: action.payload.sequence\n      });\n      var orderBookIncSideLimit = orderBookSideLimit() * 2;\n      if (action.payload.asks) {\n        payload.asks = Array.isArray(action.payload.asks[0]) ? handleIncrementalUpdateArray(state.asks, action.payload.asks, 'asks').slice(0, orderBookIncSideLimit) : handleIncrementalUpdate(state.asks, action.payload.asks, 'asks').slice(0, orderBookIncSideLimit);\n      }\n      if (action.payload.bids) {\n        payload.bids = Array.isArray(action.payload.bids[0]) ? handleIncrementalUpdateArray(state.bids, action.payload.bids, 'bids').slice(0, orderBookIncSideLimit) : handleIncrementalUpdate(state.bids, action.payload.bids, 'bids').slice(0, orderBookIncSideLimit);\n      }\n      return payload;\n    case DEPTH_DATA_SNAPSHOT:\n      var _action$payload3 = action.payload,\n        asks = _action$payload3.asks,\n        bids = _action$payload3.bids,\n        sequence = _action$payload3.sequence;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        asks: sliceArray(asks, orderBookSideLimit()),\n        bids: sliceArray(bids, orderBookSideLimit()),\n        sequence: sequence,\n        loading: false\n      });\n    default:\n      return state;\n  }\n};","map":{"version":3,"names":["orderBookSideLimit","handleIncrementalUpdate","handleIncrementalUpdateArray","sliceArray","DEPTH_DATA","DEPTH_DATA_INCREMENT","DEPTH_DATA_SNAPSHOT","DEPTH_ERROR","DEPTH_FETCH","DEPTH_INCREMENT_SUBSCRIBE","ORDER_BOOK_DATA","ORDER_BOOK_ERROR","ORDER_BOOK_FETCH","initialOrderBook","asks","bids","loading","initialDepth","initialIncrementDepth","marketId","undefined","sequence","orderBookReducer","state","action","type","error","payload","depthReducer","timestamp","Math","floor","Date","now","incrementDepthReducer","orderBookIncSideLimit","Array","isArray","slice"],"sources":["C:/Users/Elton/OneDrive/Desktop/baseapp-2024/src/modules/public/orderBook/reducer.ts"],"sourcesContent":["import { orderBookSideLimit } from '../../../api';\nimport { handleIncrementalUpdate, handleIncrementalUpdateArray, sliceArray } from '../../../helpers';\nimport { DepthActions, OrderBookActions } from './actions';\nimport {\n    DEPTH_DATA,\n    DEPTH_DATA_INCREMENT,\n    DEPTH_DATA_SNAPSHOT,\n    DEPTH_ERROR,\n    DEPTH_FETCH,\n    DEPTH_INCREMENT_SUBSCRIBE,\n    ORDER_BOOK_DATA,\n    ORDER_BOOK_ERROR,\n    ORDER_BOOK_FETCH,\n} from './constants';\nimport {\n    DepthIncrementState,\n    DepthState,\n    OrderBookState,\n} from './types';\n\n// TODO: Move market depth to his own module\n\nexport const initialOrderBook: OrderBookState = {\n    asks: [],\n    bids: [],\n    loading: false,\n};\n\nexport const initialDepth: DepthState = {\n    asks: [],\n    bids: [],\n    loading: false,\n};\n\nexport const initialIncrementDepth: DepthIncrementState = {\n    marketId: undefined,\n    asks: [],\n    bids: [],\n    sequence: null,\n    loading: false,\n};\n\nexport const orderBookReducer = (state = initialOrderBook, action: OrderBookActions): OrderBookState => {\n    switch (action.type) {\n        case ORDER_BOOK_FETCH:\n            return {\n                ...state,\n                loading: true,\n                error: undefined,\n            };\n        case ORDER_BOOK_DATA:\n            const { asks, bids } = action.payload;\n\n            return {\n                ...state,\n                asks: sliceArray(asks, orderBookSideLimit()),\n                bids: sliceArray(bids, orderBookSideLimit()),\n                loading: false,\n                error: undefined,\n            };\n        case ORDER_BOOK_ERROR:\n            return {\n                ...state,\n                loading: false,\n                error: action.error,\n            };\n        default:\n            return state;\n    }\n};\n\nexport const depthReducer = (state = initialDepth, action: DepthActions): DepthState => {\n    switch (action.type) {\n        case DEPTH_FETCH:\n            return {\n                ...state,\n                loading: true,\n                error: undefined,\n                timestamp: Math.floor(Date.now() / 1000),\n            };\n        case DEPTH_DATA:\n            const { asks, bids } = action.payload;\n\n            return {\n                ...state,\n                asks: sliceArray(asks, orderBookSideLimit()),\n                bids: sliceArray(bids, orderBookSideLimit()),\n                loading: false,\n                error: undefined,\n            };\n        case DEPTH_ERROR:\n            return {\n                ...state,\n                loading: false,\n                error: action.error,\n            };\n        default:\n            return state;\n    }\n};\n\nexport const incrementDepthReducer = (state = initialIncrementDepth, action: DepthActions): DepthIncrementState => {\n    switch (action.type) {\n        case DEPTH_INCREMENT_SUBSCRIBE:\n            return {\n                ...state,\n                marketId: action.payload,\n                loading: state.marketId === undefined || state.marketId !== action.payload,\n                timestamp: Math.floor(Date.now() / 1000),\n            };\n        case DEPTH_DATA_INCREMENT:\n            const payload = {\n                ...state,\n                sequence: action.payload.sequence,\n            };\n\n            const orderBookIncSideLimit = orderBookSideLimit() * 2;\n\n            if (action.payload.asks) {\n                payload.asks = Array.isArray(action.payload.asks[0]) ? (\n                    handleIncrementalUpdateArray(state.asks, action.payload.asks as string[][], 'asks').slice(0, orderBookIncSideLimit)\n                ) : (\n                    handleIncrementalUpdate(state.asks, action.payload.asks as string[], 'asks').slice(0, orderBookIncSideLimit)\n                );\n            }\n\n            if (action.payload.bids) {\n                payload.bids = Array.isArray(action.payload.bids[0]) ? (\n                    handleIncrementalUpdateArray(state.bids, action.payload.bids as string[][], 'bids').slice(0, orderBookIncSideLimit)\n                ) : (\n                    handleIncrementalUpdate(state.bids, action.payload.bids as string[], 'bids').slice(0, orderBookIncSideLimit)\n                );\n            }\n\n            return payload;\n        case DEPTH_DATA_SNAPSHOT:\n            const { asks, bids, sequence } = action.payload;\n\n            return {\n                ...state,\n                asks: sliceArray(asks, orderBookSideLimit()),\n                bids: sliceArray(bids, orderBookSideLimit()),\n                sequence,\n                loading: false,\n            };\n        default:\n            return state;\n    }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}